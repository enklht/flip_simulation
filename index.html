<html lang="en">

<head>
    <meta charset="utf-8">
    <title>FLIP Fluid Simulation</title>
    <style>
        html,
        body,
        canvas {
            margin: 0px;
            padding: 0px;
            width: 100%;
            height: 100%;
            overflow: hidden;
            position: absolute;
            background: black;
            z-index: 0;
        }
        #start {
            position: absolute;
            z-index: 10;
            top: 40%;
            left: 50%;
            transform: translateX(-50%);
            font-size: 20px;
        }
    </style>
</head>

<body>
    <button id="start">Tap to Start</button>
    <canvas id="glcanvas" tabindex='1'></canvas>
    <!-- Minified and statically hosted version of https://github.com/not-fl3/macroquad/blob/master/js/mq_js_bundle.js -->
    <script src="https://not-fl3.github.io/miniquad-samples/mq_js_bundle.js"></script>
    <script>
        let accel_x = 0.0;
        let accel_z = 0.0;

        async function start() {
            document.getElementById("start").remove();

            // iOS permission
            if (
                typeof DeviceMotionEvent !== "undefined" &&
                typeof DeviceMotionEvent.requestPermission === "function"
            ) {
                const res = await DeviceMotionEvent.requestPermission();
                if (res !== "granted") {
                    alert("Motion permission denied");
                    return;
                }
            }

            window.addEventListener("devicemotion", (event) => {
                const g = event.accelerationIncludingGravity;
                if (event.accelerationIncludingGravity) {
                    accel_x = g.x ?? 0.0;
                    accel_z = g.z ?? 10.0;
                }
            });

            register_plugin = function (importObject) {
                importObject.env.get_accel_x = () => accel_x;
                importObject.env.get_accel_z = () => accel_z;
            };

            miniquad_add_plugin({ register_plugin });

            load("./flip_simulation.wasm");
        }

        document.getElementById("start").onclick = start;
    </script>
</body>

</html>
